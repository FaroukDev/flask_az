- name: configure vm 
  hosts: azure-vm
  become: yes
  become_method: sudo
  remote_user: farouk
  tasks:
    - name: clone repo
      git:
        repo: "https://github.com/FaroukDev/flaskaz.git"
        dest: /home/farouk/flask_az
        update: yes # Does a git pull if the repo already exists
        version: master
    - name: install postgres
      apt:
        name: postgresql
        state: latest
    - name : Installation de psycopg2 & flask
      become: yes
      apt:
        name:
          - python3-psycopg2
          - python3-flask
          - python3-flask-mail
        state: latest
    - name: Create user psql
      become: yes
      become_user: postgres
      postgresql_user:
        name: "farouk"
        password: "pw123"
        role_attr_flags: "CREATEDB,NOSUPERUSER"
    - name: Create database
      become: yes
      become_user: postgres
      postgresql_db:
          name: "az"
          owner: "postgres"
    - name: Execute script database
      command: python3 /home/farouk/flaskaz/db.py
    - name: Execute script app.py
      command: python3 /home/farouk/flaskaz/app.py

     
    
    
    